<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ ê·¼ìœ¡ ìŠµê´€ ì¶”ì ê¸°</title>
    <meta name="description" content="í”„ë¡œì‘ê°€ë¥¼ í–¥í•œ ì—¬ì • - ê¸€ ê·¼ìœ¡ì„ í‚¤ìš°ëŠ” ì ì§„ì  í›ˆë ¨">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'korean': ['Malgun Gothic', 'Apple SD Gothic Neo', 'Noto Sans KR', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        * {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        }
        body { 
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            line-height: 1.6;
        }
        .animate-pulse-gentle {
            animation: pulse-gentle 2s infinite;
        }
        @keyframes pulse-gentle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        .session-item {
            transition: all 0.3s ease;
        }
        .session-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            <div class="max-w-4xl mx-auto">
                <!-- í—¤ë” -->
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“ ê¸€ ê·¼ìœ¡ í›ˆë ¨ì†Œ</h1>
                    <p class="text-gray-600">ì‘ê°€ì˜ ì²´ë ¥ì„ ë‹¨ê³„ë³„ë¡œ í‚¤ìš°ëŠ” ì—¬ì • ğŸ’ª</p>
                    
                    <!-- ë°ì´í„° ê´€ë¦¬ -->
                    <div class="flex items-center justify-center space-x-4 mt-4">
                        <button onclick="exportData()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">
                            ğŸ“¥ ë°ì´í„° ë‹¤ìš´ë¡œë“œ
                        </button>
                        <label class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm cursor-pointer">
                            ğŸ“¤ ë°ì´í„° ì—…ë¡œë“œ
                            <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                        </label>
                    </div>
                </div>

                <!-- í˜„ì¬ ê¸€ ê·¼ìœ¡ ë ˆë²¨ -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">í˜„ì¬ ê¸€ ê·¼ìœ¡ ë ˆë²¨</h2>
                        <div class="flex items-center justify-center space-x-4">
                            <div class="text-4xl font-bold text-blue-600" id="currentLevel">1</div>
                            <div class="text-gray-600">
                                <div class="text-lg font-semibold" id="levelDescription">ì´ˆë³´ ì‘ê°€ (5ë¶„)</div>
                                <div class="text-sm" id="levelProgress">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€: 0/7ì¼</div>
                            </div>
                        </div>
                        <!-- ì§„í–‰ ë°” -->
                        <div class="w-full bg-gray-200 rounded-full h-3 mt-4">
                            <div id="progressBar" class="bg-gradient-to-r from-blue-400 to-blue-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <!-- ë ˆë²¨ë³„ ëª©í‘œ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs">
                        <div class="p-2 bg-blue-100 rounded text-center">
                            <div class="font-semibold">Lv.1</div>
                            <div>5ë¶„</div>
                        </div>
                        <div class="p-2 bg-gray-100 rounded text-center">
                            <div class="font-semibold">Lv.2</div>
                            <div>10ë¶„</div>
                        </div>
                        <div class="p-2 bg-gray-100 rounded text-center">
                            <div class="font-semibold">Lv.3</div>
                            <div>15ë¶„</div>
                        </div>
                        <div class="p-2 bg-gray-100 rounded text-center">
                            <div class="font-semibold">Lv.âˆ</div>
                            <div>4ì‹œê°„</div>
                        </div>
                    </div>
                </div>

                <!-- ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <button onclick="changeDate(-1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                            â† ì´ì „
                        </button>
                        <div class="text-center">
                            <h2 id="currentDateText" class="text-xl font-semibold text-gray-800"></h2>
                            <p class="text-sm text-gray-500">9ì›” 1ì¼ë¶€í„° ì‹œì‘!</p>
                        </div>
                        <button onclick="changeDate(1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                            ë‹¤ìŒ â†’
                        </button>
                    </div>

                    <!-- ì˜¤ëŠ˜ì˜ ì§„í–‰ìƒí™© -->
                    <div class="flex items-center justify-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-blue-500">ğŸ¯</span>
                            <span id="progressText" class="text-sm font-medium">ì˜¤ëŠ˜ ì™„ë£Œ: 0/4</span>
                        </div>
                        <div id="progressBadge" class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                            ì‹œì‘í•´ë³´ì„¸ìš”!
                        </div>
                    </div>
                </div>

                <!-- ì†Œì„¤ì“°ê¸° - ë©”ì¸ ìŠµê´€ (ì„¸ì…˜ ì‹œìŠ¤í…œ) -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-4">
                            <div class="w-4 h-4 rounded-full bg-blue-500"></div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">ğŸ“– ì˜¤ëŠ˜ì˜ ì†Œì„¤ ì“°ê¸°</h3>
                                <p class="text-sm text-gray-600">í˜„ì¬ ëª©í‘œ: <span id="currentTarget" class="font-semibold text-blue-600">5ë¶„</span> ì´ìƒ</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-700">ì—°ì†: <span id="novel-streak">0</span>ì¼</p>
                            <p class="text-xs text-gray-500">ì´ë²ˆ ì£¼: <span id="novel-week">0</span>/7</p>
                        </div>
                    </div>

                    <!-- ì˜¤ëŠ˜ì˜ ì„¸ì…˜ë“¤ -->
                    <div class="mb-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">ì˜¤ëŠ˜ì˜ ì‘ì—… ê¸°ë¡</h4>
                        <div id="sessionsContainer" class="space-y-2 mb-3">
                            <!-- ì„¸ì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                        
                        <!-- ì´í•© í‘œì‹œ -->
                        <div id="totalSummary" class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">ì˜¤ëŠ˜ ì´ ê¸€ì“°ê¸°</span>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-blue-600" id="dailyTotal">0ë¶„ Â· 0ì</div>
                                    <div class="text-xs" id="goalStatus">ëª©í‘œê¹Œì§€ 5ë¶„ í•„ìš”</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìƒˆ ì„¸ì…˜ ì¶”ê°€ ì˜ì—­ -->
                    <div class="border-t pt-4">
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ì‹œê°„ (ë¶„)</label>
                                <input 
                                    type="number" 
                                    id="sessionMinutes" 
                                    min="1" 
                                    max="480" 
                                    placeholder="15"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">ê¸€ì ìˆ˜</label>
                                <input 
                                    type="number" 
                                    id="sessionCharacters" 
                                    min="0" 
                                    max="50000"
                                    placeholder="300"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                            </div>
                        </div>
                        
                        <button onclick="addSession()" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium mb-3">
                            + ì„¸ì…˜ ì¶”ê°€
                        </button>

                        <!-- ëª©í‘œ ë‹¬ì„± ì™„ë£Œ ë²„íŠ¼ -->
                        <button 
                            onclick="toggleDayComplete()" 
                            id="dayCompleteBtn" 
                            class="w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-gray-200 text-gray-600"
                        >
                            ì˜¤ëŠ˜ ëª©í‘œ ë‹¬ì„± ì™„ë£Œ
                        </button>
                    </div>
                </div>

                <!-- ë³´ì¡° ìŠµê´€ë“¤ -->
                <div class="grid gap-4 mb-6">
                    <!-- ìš´ë™ -->
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">ìš´ë™</h4>
                                    <p class="text-xs text-gray-600">ëª¸ì˜ ì²´ë ¥ = ê¸€ì˜ ì²´ë ¥</p>
                                </div>
                            </div>
                            <button onclick="toggleHabit('exercise')" id="exercise-btn" class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 bg-gray-200 text-gray-500">
                                <span class="text-xl">âœ—</span>
                            </button>
                        </div>
                    </div>

                    <!-- ì¼ë³¸ì–´ -->
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">ì¼ë³¸ì–´</h4>
                                    <p class="text-xs text-gray-600">ì–¸ì–´ì˜ ë‹¤ì–‘ì„± í™•ì¥</p>
                                </div>
                            </div>
                            <button onclick="toggleHabit('japanese')" id="japanese-btn" class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 bg-gray-200 text-gray-500">
                                <span class="text-xl">âœ—</span>
                            </button>
                        </div>
                    </div>

                    <!-- ë¸”ë¡œê·¸ -->
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">ë¸”ë¡œê·¸</h4>
                                    <p class="text-xs text-gray-600">ê¸€ì“°ê¸° ì‹¤ì „ ì—°ìŠµ</p>
                                </div>
                            </div>
                            <button onclick="toggleHabit('blog')" id="blog-btn" class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 bg-gray-200 text-gray-500">
                                <span class="text-xl">âœ—</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ê²©ë ¤ ë° ë¶„ì„ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“Š ê¸€ ê·¼ìœ¡ ë¶„ì„</h3>
                    
                    <!-- ì£¼ê°„ í†µê³„ -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="weeklyMinutes">0</div>
                            <div class="text-sm text-gray-600">ì´ë²ˆ ì£¼ ì´ ê¸€ì“°ê¸°</div>
                            <div class="text-xs text-gray-500">ë¶„</div>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="averageMinutes">0</div>
                            <div class="text-sm text-gray-600">ì¼í‰ê·  ê¸€ì“°ê¸°</div>
                            <div class="text-xs text-gray-500">ë¶„</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600" id="weeklyCharacters">0</div>
                            <div class="text-sm text-gray-600">ì´ë²ˆ ì£¼ ì´ ê¸€ì</div>
                            <div class="text-xs text-gray-500">ì</div>
                        </div>
                        <div class="text-center p-4 bg-orange-50 rounded-lg">
                            <div class="text-2xl font-bold text-orange-600" id="averageCharacters">0</div>
                            <div class="text-sm text-gray-600">ì¼í‰ê·  ê¸€ì</div>
                            <div class="text-xs text-gray-500">ì</div>
                        </div>
                    </div>

                    <!-- ì„±ì¥ ì§€í‘œ -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-3">ğŸ“ˆ ì„±ì¥ ì§€í‘œ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ë¶„ë‹¹ í‰ê·  ê¸€ì ìˆ˜:</span>
                                <span id="charactersPerMinute" class="font-medium text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ìµœê³  ê¸°ë¡ (ì¼ì¼):</span>
                                <span id="dailyBest" class="font-medium text-gray-800">0ì</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ìµœì¥ ì—°ì†:</span>
                                <span id="longestStreak" class="font-medium text-gray-800">0ì¼</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ì´ ëˆ„ì :</span>
                                <span id="totalCharacters" class="font-medium text-gray-800">0ì</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì½”ì¹˜ì˜ ì¡°ì–¸ -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-2">ğŸ‹ï¸ ì½”ì¹˜ì˜ ì¡°ì–¸</h4>
                        <p id="coachAdvice" class="text-sm text-gray-700 mb-2">
                            ê¸€ ê·¼ìœ¡ì€ í•˜ë£¨ì•„ì¹¨ì— ìƒê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¾¸ì¤€í•¨ì´ í•µì‹¬ì´ì—ìš”.
                        </p>
                        <p class="text-xs text-gray-600" id="nextLevelHint">
                            ğŸ’¡ 7ì¼ ì—°ì† ë‹¬ì„±í•˜ë©´ ë‹¤ìŒ ë ˆë²¨ë¡œ ìŠ¹ê¸‰í•©ë‹ˆë‹¤!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê¸€ ê·¼ìœ¡ ë ˆë²¨ ì‹œìŠ¤í…œ
        const WRITING_LEVELS = [
            { level: 1, minutes: 5, title: "ì´ˆë³´ ì‘ê°€", description: "ì²« ê±¸ìŒì„ ë–¼ëŠ” ë‹¨ê³„", daysRequired: 7 },
            { level: 2, minutes: 10, title: "ìŠµê´€ ì‘ê°€", description: "ë£¨í‹´ì´ ì¡íˆëŠ” ë‹¨ê³„", daysRequired: 7 },
            { level: 3, minutes: 15, title: "ê¾¸ì¤€í•œ ì‘ê°€", description: "ì•ˆì •ì ì¸ ê¸€ì“°ê¸°", daysRequired: 7 },
            { level: 4, minutes: 20, title: "ì§‘ì¤‘ ì‘ê°€", description: "ëª°ì…ì˜ ì‹œì‘", daysRequired: 10 },
            { level: 5, minutes: 30, title: "ì§€ì† ì‘ê°€", description: "ê¹Šì€ ì‚¬ê³ ì˜ ì‹œì‘", daysRequired: 10 },
            { level: 6, minutes: 45, title: "ìˆ™ë ¨ ì‘ê°€", description: "ê¸€ì˜ íë¦„ì„ íƒ€ëŠ” ë‹¨ê³„", daysRequired: 14 },
            { level: 7, minutes: 60, title: "ì „ë¬¸ ì‘ê°€", description: "1ì‹œê°„ ì§‘ì¤‘ë ¥ ì™„ì„±", daysRequired: 14 },
            { level: 8, minutes: 90, title: "ë§ˆìŠ¤í„° ì‘ê°€", description: "ê¹Šì€ ëª°ì… ìƒíƒœ", daysRequired: 21 },
            { level: 9, minutes: 120, title: "ë² í…Œë‘ ì‘ê°€", description: "2ì‹œê°„ ì—°ì† ê¸€ì“°ê¸°", daysRequired: 21 },
            { level: 10, minutes: 180, title: "í”„ë¡œ ì‘ê°€", description: "3ì‹œê°„ ì§€êµ¬ë ¥", daysRequired: 30 },
            { level: 11, minutes: 240, title: "ë§ˆë¼í†¤ ì‘ê°€", description: "4ì‹œê°„ ì™„ì£¼ ê°€ëŠ¥", daysRequired: 30 }
        ];

        // ì „ì—­ ìƒíƒœ
        let state = {
            currentDate: new Date(),
            habitData: JSON.parse(localStorage.getItem('habitData') || '{}'),
            currentLevel: parseInt(localStorage.getItem('currentLevel') || '1'),
            levelProgress: parseInt(localStorage.getItem('levelProgress') || '0')
        };

        const habits = ['exercise', 'japanese', 'blog'];

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDate(date) {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            return date.toLocaleDateString('ko-KR', options);
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function getCurrentLevel() {
            return WRITING_LEVELS.find(level => level.level === state.currentLevel) || WRITING_LEVELS[0];
        }

        // ì…ë ¥ ê²€ì¦ í•¨ìˆ˜
        function validateSessionInput(minutes, characters) {
            const errors = [];
            
            if (!minutes || isNaN(minutes)) {
                errors.push('ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            } else if (minutes <= 0) {
                errors.push('ì‹œê°„ì€ 1ë¶„ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
            } else if (minutes > 480) {
                errors.push('ì‹œê°„ì€ 8ì‹œê°„(480ë¶„) ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
            
            if (characters !== null && characters !== undefined && characters !== '') {
                if (isNaN(characters)) {
                    errors.push('ê¸€ì ìˆ˜ëŠ” ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                } else if (characters < 0) {
                    errors.push('ê¸€ì ìˆ˜ëŠ” ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                } else if (characters > 50000) {
                    errors.push('ê¸€ì ìˆ˜ëŠ” 50,000ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
            }
            
            return errors;
        }

        // ë°ì´í„° ê²€ì¦ ë° ìˆ˜ì • í•¨ìˆ˜
        function validateAndFixWritingData(data) {
            if (!data) return createEmptyWritingData();
            
            // ê¸°ë³¸ êµ¬ì¡° í™•ì¸ ë° ìƒì„±
            if (!data.sessions) data.sessions = [];
            if (typeof data.completed !== 'boolean') data.completed = false;
            
            // ì„¸ì…˜ ë°ì´í„° ê²€ì¦
            data.sessions = data.sessions.filter(session => {
                return session && 
                       typeof session.timestamp === 'number' && 
                       typeof session.minutes === 'number' && 
                       session.minutes > 0 &&
                       typeof session.characters === 'number' && 
                       session.characters >= 0;
            });
            
            // ì´í•© ì¬ê³„ì‚°
            data.totalMinutes = data.sessions.reduce((sum, s) => sum + s.minutes, 0);
            data.totalCharacters = data.sessions.reduce((sum, s) => sum + s.characters, 0);
            
            return data;
        }

        function createEmptyWritingData() {
            return {
                completed: false,
                sessions: [],
                totalMinutes: 0,
                totalCharacters: 0
            };
        }

        function getWritingData(date) {
            const dateKey = getDateKey(date);
            const rawData = state.habitData[dateKey]?.writing;
            
            // ì´ì „ í˜•ì‹ í˜¸í™˜ì„± ì²˜ë¦¬
            if (rawData && rawData.minutes !== undefined && !rawData.sessions) {
                const convertedData = {
                    completed: rawData.completed || false,
                    sessions: rawData.completed ? [{
                        timestamp: createTimestamp(date, 9, 0),
                        minutes: rawData.minutes || 0,
                        characters: rawData.characters || 0
                    }] : [],
                    totalMinutes: rawData.minutes || 0,
                    totalCharacters: rawData.characters || 0
                };
                
                // ë³€í™˜ëœ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
                saveWritingData(date, convertedData);
                return convertedData;
            }
            
            return validateAndFixWritingData(rawData);
        }

        function createTimestamp(date, hours = null, minutes = null) {
            const newDate = new Date(date);
            if (hours !== null) newDate.setHours(hours);
            if (minutes !== null) newDate.setMinutes(minutes);
            return newDate.getTime();
        }

        function saveWritingData(date, writingData) {
            try {
                const dateKey = getDateKey(date);
                if (!state.habitData[dateKey]) {
                    state.habitData[dateKey] = {};
                }
                
                // ë°ì´í„° ê²€ì¦ í›„ ì €ì¥
                state.habitData[dateKey].writing = validateAndFixWritingData(writingData);
                localStorage.setItem('habitData', JSON.stringify(state.habitData));
                
                return true;
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
                showNotification('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                return false;
            }
        }

        function isHabitDone(habitId) {
            const dateKey = getDateKey(state.currentDate);
            if (habitId === 'writing') {
                return state.habitData[dateKey]?.writing?.completed || false;
            }
            return state.habitData[dateKey]?.[habitId] || false;
        }

        function getWritingStreak() {
            let streak = 0;
            let checkDate = new Date(state.currentDate);
            
            while (true) {
                const writingData = getWritingData(checkDate);
                if (writingData.completed) {
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            return streak;
        }

        function getLongestStreak() {
            let maxStreak = 0;
            let currentStreak = 0;
            
            const allDates = Object.keys(state.habitData)
                .filter(dateKey => state.habitData[dateKey].writing?.completed)
                .sort();
            
            for (let i = 0; i < allDates.length; i++) {
                if (i === 0) {
                    currentStreak = 1;
                } else {
                    const prevDate = new Date(allDates[i - 1]);
                    const currDate = new Date(allDates[i]);
                    const diffDays = (currDate - prevDate) / (1000 * 60 * 60 * 24);
                    
                    if (diffDays === 1) {
                        currentStreak++;
                    } else {
                        maxStreak = Math.max(maxStreak, currentStreak);
                        currentStreak = 1;
                    }
                }
            }
            
            return Math.max(maxStreak, currentStreak);
        }

        function getWeeklyWritingStats() {
            let totalMinutes = 0;
            let totalCharacters = 0;
            let completedDays = 0;
            const today = new Date(state.currentDate);
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const writingData = getWritingData(date);
                
                if (writingData.completed) {
                    totalMinutes += writingData.totalMinutes;
                    totalCharacters += writingData.totalCharacters;
                    completedDays++;
                }
            }
            
            return {
                totalMinutes,
                totalCharacters,
                completedDays,
                averageMinutes: completedDays > 0 ? Math.round(totalMinutes / completedDays) : 0,
                averageCharacters: completedDays > 0 ? Math.round(totalCharacters / completedDays) : 0
            };
        }

        function getTotalStats() {
            let totalCharacters = 0;
            let totalMinutes = 0;
            let maxDailyCharacters = 0;
            
            Object.values(state.habitData).forEach(dayData => {
                if (dayData.writing?.completed) {
                    const chars = dayData.writing.totalCharacters || 0;
                    const mins = dayData.writing.totalMinutes || 0;
                    
                    totalCharacters += chars;
                    totalMinutes += mins;
                    maxDailyCharacters = Math.max(maxDailyCharacters, chars);
                }
            });
            
            return {
                totalCharacters,
                totalMinutes,
                maxDailyCharacters,
                charactersPerMinute: totalMinutes > 0 ? Math.round(totalCharacters / totalMinutes) : 0
            };
        }

        // ì•Œë¦¼ ì‹œìŠ¤í…œ
        function showNotification(message, type = 'info') {
            // ê°„ë‹¨í•œ ì•Œë¦¼ ì‹œìŠ¤í…œ (ë‚˜ì¤‘ì— ë” ì˜ˆì˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ)
            if (type === 'error') {
                alert('ì˜¤ë¥˜: ' + message);
            } else {
                console.log(message);
            }
        }

        // ì„¸ì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function addSession() {
            try {
                const minutesValue = document.getElementById('sessionMinutes').value;
                const charactersValue = document.getElementById('sessionCharacters').value;
                
                const minutes = parseInt(minutesValue) || 0;
                const characters = parseInt(charactersValue) || 0;
                
                // ì…ë ¥ ê²€ì¦
                const errors = validateSessionInput(minutes, characters);
                if (errors.length > 0) {
                    alert(errors.join('\n'));
                    return;
                }
                
                const writingData = getWritingData(state.currentDate);
                const newSession = {
                    timestamp: Date.now(),
                    minutes: minutes,
                    characters: characters
                };
                
                writingData.sessions.push(newSession);
                
                // ì´í•© ì¦ë¶„ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ê°œì„ )
                writingData.totalMinutes += minutes;
                writingData.totalCharacters += characters;
                
                if (saveWritingData(state.currentDate, writingData)) {
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('sessionMinutes').value = '';
                    document.getElementById('sessionCharacters').value = '';
                    
                    updateUI();
                    showNotification('ì„¸ì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
                
            } catch (error) {
                console.error('ì„¸ì…˜ ì¶”ê°€ ì˜¤ë¥˜:', error);
                showNotification('ì„¸ì…˜ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function editSession(index) {
            try {
                const writingData = getWritingData(state.currentDate);
                if (index < 0 || index >= writingData.sessions.length) return;
                
                const session = writingData.sessions[index];
                const newMinutes = prompt('ì‹œê°„ì„ ìˆ˜ì •í•˜ì„¸ìš” (ë¶„):', session.minutes);
                const newCharacters = prompt('ê¸€ì ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”:', session.characters);
                
                if (newMinutes === null || newCharacters === null) return;
                
                const minutes = parseInt(newMinutes) || 0;
                const characters = parseInt(newCharacters) || 0;
                
                const errors = validateSessionInput(minutes, characters);
                if (errors.length > 0) {
                    alert(errors.join('\n'));
                    return;
                }
                
                // ì´ì „ ê°’ ë¹¼ê³  ìƒˆ ê°’ ë”í•˜ê¸° (ì¦ë¶„ ì—…ë°ì´íŠ¸)
                writingData.totalMinutes = writingData.totalMinutes - session.minutes + minutes;
                writingData.totalCharacters = writingData.totalCharacters - session.characters + characters;
                
                session.minutes = minutes;
                session.characters = characters;
                
                if (saveWritingData(state.currentDate, writingData)) {
                    updateUI();
                    showNotification('ì„¸ì…˜ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
                
            } catch (error) {
                console.error('ì„¸ì…˜ ìˆ˜ì • ì˜¤ë¥˜:', error);
                showNotification('ì„¸ì…˜ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function removeSession(index) {
            try {
                if (!confirm('ì´ ì„¸ì…˜ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                
                const writingData = getWritingData(state.currentDate);
                if (index < 0 || index >= writingData.sessions.length) return;
                
                const session = writingData.sessions[index];
                
                // ì´í•©ì—ì„œ ì œê±°í•  ì„¸ì…˜ ê°’ ë¹¼ê¸° (ì¦ë¶„ ì—…ë°ì´íŠ¸)
                writingData.totalMinutes -= session.minutes;
                writingData.totalCharacters -= session.characters;
                
                writingData.sessions.splice(index, 1);
                
                // ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ì™„ë£Œ ìƒíƒœ í•´ì œ
                if (writingData.sessions.length === 0) {
                    writingData.completed = false;
                }
                
                if (saveWritingData(state.currentDate, writingData)) {
                    checkLevelProgress();
                    updateUI();
                    showNotification('ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('ì„¸ì…˜ ì‚­ì œ ì˜¤ë¥˜:', error);
                showNotification('ì„¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function toggleDayComplete() {
            try {
                const writingData = getWritingData(state.currentDate);
                const currentLevel = getCurrentLevel();
                
                if (!writingData.completed && writingData.totalMinutes < currentLevel.minutes) {
                    alert(`ëª©í‘œ ì‹œê°„(${currentLevel.minutes}ë¶„)ì„ ë‹¬ì„±í•œ í›„ ì™„ë£Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    return;
                }
                
                writingData.completed = !writingData.completed;
                
                if (saveWritingData(state.currentDate, writingData)) {
                    checkLevelUp();
                    updateUI();
                    
                    if (writingData.completed) {
                        showNotification('ğŸ‰ ì˜¤ëŠ˜ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!');
                    }
                }
                
            } catch (error) {
                console.error('ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
                showNotification('ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function renderSessions() {
            const container = document.getElementById('sessionsContainer');
            const writingData = getWritingData(state.currentDate);
            
            if (writingData.sessions.length === 0) {
                container.innerHTML = '<div class="text-sm text-gray-500 text-center py-4">ì•„ì§ ì‘ì—… ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ì„¸ì…˜ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>';
                return;
            }
            
            // ì„¸ì…˜ì„ ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedSessions = [...writingData.sessions].sort((a, b) => a.timestamp - b.timestamp);
            
            container.innerHTML = sortedSessions.map((session, originalIndex) => {
                // ì›ë³¸ ë°°ì—´ì—ì„œì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
                const realIndex = writingData.sessions.findIndex(s => s.timestamp === session.timestamp);
                const time = formatTime(session.timestamp);
                
                return `
                    <div class="session-item flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-sm font-medium text-gray-800">${time} ì„¸ì…˜</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="text-sm text-gray-600">
                                <span class="font-medium">${session.minutes}ë¶„</span>
                                ${session.characters > 0 ? ` Â· <span class="font-medium">${session.characters.toLocaleString()}ì</span>` : ''}
                            </div>
                            <div class="flex space-x-1">
                                <button onclick="editSession(${realIndex})" class="text-blue-500 hover:text-blue-700 text-xs px-2 py-1 rounded" title="ìˆ˜ì •">
                                    âœï¸
                                </button>
                                <button onclick="removeSession(${realIndex})" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 rounded" title="ì‚­ì œ">
                                    âœ•
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDailySummary() {
            const writingData = getWritingData(state.currentDate);
            const currentLevel = getCurrentLevel();
            
            document.getElementById('dailyTotal').textContent = 
                `${writingData.totalMinutes}ë¶„ Â· ${writingData.totalCharacters.toLocaleString()}ì`;
            
            const goalStatus = document.getElementById('goalStatus');
            if (writingData.totalMinutes >= currentLevel.minutes) {
                goalStatus.textContent = 'âœ… ëª©í‘œ ë‹¬ì„±!';
                goalStatus.className = 'text-xs text-green-600';
            } else {
                const remaining = currentLevel.minutes - writingData.totalMinutes;
                goalStatus.textContent = `ëª©í‘œê¹Œì§€ ${remaining}ë¶„ í•„ìš”`;
                goalStatus.className = 'text-xs text-gray-600';
            }
        }

        function updateDayCompleteButton() {
            const writingData = getWritingData(state.currentDate);
            const btn = document.getElementById('dayCompleteBtn');
            const currentLevel = getCurrentLevel();
            
            if (writingData.completed) {
                btn.className = 'w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-green-500 text-white shadow-lg';
                btn.textContent = 'âœ… ì˜¤ëŠ˜ ëª©í‘œ ë‹¬ì„± ì™„ë£Œë¨';
                btn.disabled = false;
            } else {
                const canComplete = writingData.totalMinutes >= currentLevel.minutes;
                
                if (canComplete) {
                    btn.className = 'w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-blue-500 text-white hover:bg-blue-600';
                    btn.textContent = 'ëª©í‘œ ë‹¬ì„± ì™„ë£Œí•˜ê¸°';
                    btn.disabled = false;
                } else {
                    btn.className = 'w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-gray-300 text-gray-600 cursor-not-allowed';
                    btn.textContent = `ëª©í‘œ ë‹¬ì„± í›„ ì™„ë£Œ ê°€ëŠ¥ (${currentLevel.minutes}ë¶„ í•„ìš”)`;
                    btn.disabled = true;
                }
            }
        }

        // ë ˆë²¨ ì—… ì²´í¬
        function checkLevelUp() {
            const currentLevelData = getCurrentLevel();
            const streak = getWritingStreak();
            
            if (streak >= currentLevelData.daysRequired && state.currentLevel < WRITING_LEVELS.length) {
                const oldLevel = state.currentLevel;
                state.currentLevel++;
                state.levelProgress = 0;
                localStorage.setItem('currentLevel', state.currentLevel.toString());
                localStorage.setItem('levelProgress', '0');
                
                setTimeout(() => {
                    alert(`ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! Lv.${oldLevel} ${currentLevelData.title}ì—ì„œ Lv.${state.currentLevel}ë¡œ ë ˆë²¨ì—…í–ˆìŠµë‹ˆë‹¤!`);
                }, 500);
            } else {
                state.levelProgress = Math.min(streak, currentLevelData.daysRequired);
                localStorage.setItem('levelProgress', state.levelProgress.toString());
            }
        }

        function checkLevelProgress() {
            const currentLevelData = getCurrentLevel();
            const streak = getWritingStreak();
            state.levelProgress = Math.min(streak, currentLevelData.daysRequired);
            localStorage.setItem('levelProgress', state.levelProgress.toString());
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            try {
                // ë‚ ì§œ ì—…ë°ì´íŠ¸
                document.getElementById('currentDateText').textContent = formatDate(state.currentDate);
                
                // í˜„ì¬ ë ˆë²¨ ì •ë³´ ì—…ë°ì´íŠ¸
                const currentLevelData = getCurrentLevel();
                document.getElementById('currentLevel').textContent = currentLevelData.level;
                document.getElementById('levelDescription').textContent = `${currentLevelData.title} (${currentLevelData.minutes}ë¶„)`;
                document.getElementById('levelProgress').textContent = 
                    `ë‹¤ìŒ ë ˆë²¨ê¹Œì§€: ${state.levelProgress}/${currentLevelData.daysRequired}ì¼`;
                
                // ì§„í–‰ ë°” ì—…ë°ì´íŠ¸
                const progressPercentage = (state.levelProgress / currentLevelData.daysRequired) * 100;
                document.getElementById('progressBar').style.width = `${progressPercentage}%`;
                
                // í˜„ì¬ ëª©í‘œ ì—…ë°ì´íŠ¸
                document.getElementById('currentTarget').textContent = `${currentLevelData.minutes}ë¶„`;
                
                // ì„¸ì…˜ ë Œë”ë§
                renderSessions();
                updateDailySummary();
                updateDayCompleteButton();
                
                // ì—°ì† ê¸°ë¡ ë° ì£¼ê°„ í†µê³„
                document.getElementById('novel-streak').textContent = getWritingStreak();
                
                const weekStats = getWeeklyWritingStats();
                const totalStats = getTotalStats();
                
                document.getElementById('novel-week').textContent = weekStats.completedDays;
                document.getElementById('weeklyMinutes').textContent = weekStats.totalMinutes;
                document.getElementById('averageMinutes').textContent = weekStats.averageMinutes;
                document.getElementById('weeklyCharacters').textContent = weekStats.totalCharacters.toLocaleString();
                document.getElementById('averageCharacters').textContent = weekStats.averageCharacters.toLocaleString();
                
                // ì„±ì¥ ì§€í‘œ ì—…ë°ì´íŠ¸
                document.getElementById('charactersPerMinute').textContent = 
                    totalStats.charactersPerMinute > 0 ? `${totalStats.charactersPerMinute}ì/ë¶„` : '-';
                document.getElementById('dailyBest').textContent = `${totalStats.maxDailyCharacters.toLocaleString()}ì`;
                document.getElementById('longestStreak').textContent = `${getLongestStreak()}ì¼`;
                document.getElementById('totalCharacters').textContent = `${totalStats.totalCharacters.toLocaleString()}ì`;
                
                // ì§„í–‰ìƒí™© ê³„ì‚°
                const todayWriting = getWritingData(state.currentDate);
                const completedToday = habits.filter(h => isHabitDone(h)).length + (todayWriting.completed ? 1 : 0);
                document.getElementById('progressText').textContent = `ì˜¤ëŠ˜ ì™„ë£Œ: ${completedToday}/4`;
                
                // ë³´ì¡° ìŠµê´€ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                habits.forEach(habit => {
                    const btn = document.getElementById(`${habit}-btn`);
                    const isDone = isHabitDone(habit);
                    
                    if (isDone) {
                        const colors = {
                            exercise: 'bg-green-500',
                            japanese: 'bg-yellow-500',
                            blog: 'bg-purple-500'
                        };
                        btn.className = `w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${colors[habit]} text-white shadow-lg`;
                        btn.innerHTML = '<span class="text-xl">âœ“</span>';
                    } else {
                        btn.className = 'w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 bg-gray-200 text-gray-500 hover:bg-gray-300';
                        btn.innerHTML = '<span class="text-xl">âœ—</span>';
                    }
                });
                
                // ì½”ì¹˜ ì¡°ì–¸ ì—…ë°ì´íŠ¸
                updateCoachAdvice(weekStats, completedToday, totalStats);
                
            } catch (error) {
                console.error('UI ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                showNotification('í™”ë©´ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function updateCoachAdvice(weekStats, completedToday, totalStats) {
            const advice = document.getElementById('coachAdvice');
            const hint = document.getElementById('nextLevelHint');
            const streak = getWritingStreak();
            const currentLevelData = getCurrentLevel();
            
            // ì½”ì¹˜ ì¡°ì–¸ ì—…ë°ì´íŠ¸
            if (totalStats.totalCharacters > 100000) {
                advice.textContent = `ëˆ„ì  ${totalStats.totalCharacters.toLocaleString()}ì ë‹¬ì„±! ì´ì œ ì§„ì§œ í”„ë¡œ ì†Œì„¤ê°€ì˜ ëª¨ìŠµì´ ë³´ì…ë‹ˆë‹¤.`;
            } else if (totalStats.totalCharacters > 50000) {
                advice.textContent = `ëˆ„ì  ${totalStats.totalCharacters.toLocaleString()}ì! ê¾¸ì¤€íˆ ìŒ“ì¸ ê¸€ì˜ í˜ì´ ëŒ€ë‹¨í•©ë‹ˆë‹¤.`;
            } else if (totalStats.totalCharacters > 10000) {
                advice.textContent = `ëˆ„ì  ${totalStats.totalCharacters.toLocaleString()}ì! ê¾¸ì¤€í•¨ì˜ ê²°ì‹¤ì´ ë³´ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤.`;
            } else if (streak >= 14) {
                advice.textContent = "2ì£¼ ì—°ì† ë‹¬ì„±! ì´ì œ ê¸€ì“°ê¸°ê°€ ì™„ì „íˆ ìŠµê´€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.";
            } else if (streak >= 7) {
                advice.textContent = "ì¼ì£¼ì¼ ì—°ì† ë‹¬ì„±! ì´ì œ ê¸€ì“°ê¸°ê°€ ìì—°ìŠ¤ëŸ¬ìš´ ìŠµê´€ì´ ë˜ì–´ê°€ê³  ìˆìŠµë‹ˆë‹¤.";
            } else if (streak >= 3) {
                advice.textContent = "ì¢‹ì€ íë¦„ì´ì—ìš”! ì—°ì† ê¸°ë¡ì„ ìœ ì§€í•˜ë©´ì„œ ê¸€ ê·¼ìœ¡ì„ ë‹¨ë‹¨íˆ ë§Œë“¤ì–´ê°€ì„¸ìš”.";
            } else if (weekStats.completedDays >= 4) {
                advice.textContent = "ì´ë²ˆ ì£¼ ì˜ í•˜ê³  ìˆì–´ìš”. ê¾¸ì¤€í•¨ì´ ì¬ëŠ¥ì„ ì´ê¹ë‹ˆë‹¤.";
            } else {
                advice.textContent = "ê´œì°®ì•„ìš”. ì‘ì€ ì‹œì‘ì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤. ì˜¤ëŠ˜ë¶€í„° ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”.";
            }
            
            // ë‹¤ìŒ ë ˆë²¨ íŒíŠ¸ ì—…ë°ì´íŠ¸
            const remainingDays = currentLevelData.daysRequired - state.levelProgress;
            if (remainingDays > 0) {
                hint.textContent = `ğŸ’¡ ${remainingDays}ì¼ ë” ì—°ì†ìœ¼ë¡œ ë‹¬ì„±í•˜ë©´ ë‹¤ìŒ ë ˆë²¨ë¡œ ìŠ¹ê¸‰!`;
            } else {
                hint.textContent = "ğŸ‰ ë ˆë²¨ì—… ì¡°ê±´ ë‹¬ì„±! ê³„ì† ìœ ì§€í•˜ë©´ ìŠ¹ê¸‰í•©ë‹ˆë‹¤!";
            }
        }

        // ë³´ì¡° ìŠµê´€ í† ê¸€
        function toggleHabit(habitId) {
            try {
                const dateKey = getDateKey(state.currentDate);
                
                if (!state.habitData[dateKey]) {
                    state.habitData[dateKey] = {};
                }
                
                state.habitData[dateKey][habitId] = !state.habitData[dateKey][habitId];
                localStorage.setItem('habitData', JSON.stringify(state.habitData));
                
                updateUI();
                
            } catch (error) {
                console.error('ìŠµê´€ í† ê¸€ ì˜¤ë¥˜:', error);
                showNotification('ìŠµê´€ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë‚ ì§œ ë³€ê²½
        function changeDate(days) {
            const newDate = new Date(state.currentDate);
            newDate.setDate(newDate.getDate() + days);
            state.currentDate = newDate;
            updateUI();
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            try {
                const exportData = {
                    habitData: state.habitData,
                    currentLevel: state.currentLevel,
                    levelProgress: state.levelProgress,
                    exportDate: new Date().toISOString(),
                    version: '2.0' // ë²„ì „ ì •ë³´ ì¶”ê°€
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                const fileName = `writing_habits_${new Date().toISOString().split('T')[0]}.json`;
                
                link.href = URL.createObjectURL(dataBlob);
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
                
                showNotification('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
                showNotification('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê°•í™”ëœ í˜¸í™˜ì„± ì²˜ë¦¬)
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    let convertedCount = 0;
                    
                    // ë°ì´í„° ê²€ì¦ ë° ë³€í™˜
                    if (importedData.habitData) {
                        const convertedData = {};
                        
                        Object.keys(importedData.habitData).forEach(dateKey => {
                            const dayData = importedData.habitData[dateKey];
                            convertedData[dateKey] = { ...dayData };
                            
                            // ì´ì „ novel í˜•ì‹ì„ ìƒˆ writing í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                            if (dayData.novel !== undefined) {
                                convertedData[dateKey].writing = {
                                    completed: dayData.novel,
                                    sessions: dayData.novel ? [{
                                        timestamp: createTimestamp(new Date(dateKey), 9, 0),
                                        minutes: 5,
                                        characters: 0
                                    }] : [],
                                    totalMinutes: dayData.novel ? 5 : 0,
                                    totalCharacters: 0
                                };
                                delete convertedData[dateKey].novel;
                                convertedCount++;
                            }
                            
                            // ì´ì „ ë‹¨ì¼ ê¸°ë¡ì„ ì„¸ì…˜ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                            else if (convertedData[dateKey].writing && 
                                    convertedData[dateKey].writing.minutes !== undefined && 
                                    !convertedData[dateKey].writing.sessions) {
                                
                                const writing = convertedData[dateKey].writing;
                                convertedData[dateKey].writing = {
                                    completed: writing.completed || false,
                                    sessions: writing.completed ? [{
                                        timestamp: createTimestamp(new Date(dateKey), 9, 0),
                                        minutes: writing.minutes || 0,
                                        characters: writing.characters || 0
                                    }] : [],
                                    totalMinutes: writing.minutes || 0,
                                    totalCharacters: writing.characters || 0
                                };
                                convertedCount++;
                            }
                            
                            // ë°ì´í„° ê²€ì¦ ë° ìˆ˜ì •
                            if (convertedData[dateKey].writing) {
                                convertedData[dateKey].writing = validateAndFixWritingData(convertedData[dateKey].writing);
                            }
                        });
                        
                        // ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©
                        state.habitData = { ...state.habitData, ...convertedData };
                        localStorage.setItem('habitData', JSON.stringify(state.habitData));
                    }
                    
                    if (importedData.currentLevel) {
                        state.currentLevel = Math.max(1, Math.min(importedData.currentLevel, WRITING_LEVELS.length));
                        localStorage.setItem('currentLevel', state.currentLevel.toString());
                    }
                    
                    if (importedData.levelProgress !== undefined) {
                        state.levelProgress = Math.max(0, importedData.levelProgress);
                        localStorage.setItem('levelProgress', state.levelProgress.toString());
                    }
                    
                    updateUI();
                    
                    let message = 'ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!';
                    if (convertedCount > 0) {
                        message += `\n${convertedCount}ê°œì˜ ì´ì „ ê¸°ë¡ì„ ìƒˆ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤.`;
                    }
                    
                    alert(message);
                    
                } catch (error) {
                    console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        // ë°ì´í„° ì •í•©ì„± ê²€ì‚¬ ë° ìˆ˜ì •
        function performDataIntegrityCheck() {
            let fixedCount = 0;
            
            Object.keys(state.habitData).forEach(dateKey => {
                if (state.habitData[dateKey].writing) {
                    const originalData = { ...state.habitData[dateKey].writing };
                    const fixedData = validateAndFixWritingData(state.habitData[dateKey].writing);
                    
                    if (JSON.stringify(originalData) !== JSON.stringify(fixedData)) {
                        state.habitData[dateKey].writing = fixedData;
                        fixedCount++;
                    }
                }
            });
            
            if (fixedCount > 0) {
                localStorage.setItem('habitData', JSON.stringify(state.habitData));
                console.log(`${fixedCount}ê°œì˜ ë°ì´í„° ë¶ˆì¼ì¹˜ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.`);
            }
            
            return fixedCount;
        }

        // ì´ˆê¸°í™”
        function init() {
            console.log('ê¸€ ê·¼ìœ¡ í›ˆë ¨ì†Œ ì‹œì‘ - ê°œì„ ëœ ì„¸ì…˜ ì‹œìŠ¤í…œ v2.0');
            
            try {
                // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì„¸ì…˜ í˜•ì‹ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
                let hasUpdated = false;
                
                Object.keys(state.habitData).forEach(dateKey => {
                    const dayData = state.habitData[dateKey];
                    
                    // ì´ì „ novel í˜•ì‹ ë³€í™˜
                    if (dayData.novel !== undefined) {
                        dayData.writing = {
                            completed: dayData.novel,
                            sessions: dayData.novel ? [{
                                timestamp: createTimestamp(new Date(dateKey), 9, 0),
                                minutes: 5,
                                characters: 0
                            }] : [],
                            totalMinutes: dayData.novel ? 5 : 0,
                            totalCharacters: 0
                        };
                        delete dayData.novel;
                        hasUpdated = true;
                    }
                    
                    // ì´ì „ ë‹¨ì¼ writing í˜•ì‹ ë³€í™˜
                    else if (dayData.writing && dayData.writing.minutes !== undefined && !dayData.writing.sessions) {
                        const writing = dayData.writing;
                        dayData.writing = {
                            completed: writing.completed || false,
                            sessions: writing.completed ? [{
                                timestamp: createTimestamp(new Date(dateKey), 9, 0),
                                minutes: writing.minutes || 0,
                                characters: writing.characters || 0
                            }] : [],
                            totalMinutes: writing.minutes || 0,
                            totalCharacters: writing.characters || 0
                        };
                        hasUpdated = true;
                    }
                });
                
                if (hasUpdated) {
                    localStorage.setItem('habitData', JSON.stringify(state.habitData));
                    console.log('ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
                }
                
                // ë°ì´í„° ì •í•©ì„± ê²€ì‚¬
                const fixedCount = performDataIntegrityCheck();
                if (fixedCount > 0) {
                    console.log('ë°ì´í„° ì •í•©ì„± ê²€ì‚¬ ë° ìˆ˜ì • ì™„ë£Œ');
                }
                
                updateUI();
                console.log('ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                showNotification('ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì¶”ê°€
        document.addEventListener('keydown', function(event) {
            // Ctrl+Enter ë˜ëŠ” Cmd+Enterë¡œ ì„¸ì…˜ ì¶”ê°€
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                event.preventDefault();
                addSession();
            }
        });

        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(init, 100);
        });
    </script>
</body>
</html>
